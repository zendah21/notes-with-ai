<div id="task-card-{{ task.id }}" class="col-12 col-md-6 col-lg-4 mb-3">
  <div class="card shadow-sm h-100">
    <div class="card-body d-flex flex-column">
      <div class="d-flex align-items-start justify-content-between mb-2">
        <h5 class="card-title mb-0" title="{{ task.title }}">{{ task.title }}</h5>
        <div>
          {% set st = task.status %}
          {% set st_cls = 'secondary' %}
          {% if st == 'done' %}{% set st_cls = 'success' %}{% elif st == 'in_progress' %}{% set st_cls = 'info' %}{% endif %}
          <span class="badge text-bg-{{ st_cls }}">{{ st.replace('_',' ') }}</span>
        </div>
      </div>

      <div class="mb-2 small text-muted">
        {% set pr = task.priority %}
        {% set pr_cls = 'secondary' %}
        {% if pr == 'high' %}{% set pr_cls = 'warning' %}{% elif pr == 'urgent' %}{% set pr_cls = 'danger' %}{% elif pr == 'low' %}{% set pr_cls = 'secondary' %}{% else %}{% set pr_cls = 'secondary' %}{% endif %}
        <span class="badge text-bg-{{ pr_cls }} me-1">{{ task.priority }}</span>
        {% if task.estimated_duration_minutes %}
          <span class="badge text-bg-light border me-1">⏱ {{ task.estimated_duration_minutes }}m</span>
        {% endif %}
        {% if task.deadline_utc %}
          <span class="badge text-bg-light border">📅 {{ task.deadline_utc.strftime('%Y-%m-%d %H:%M') }} UTC</span>
        {% endif %}
      </div>

      {% if task.tag_list() %}
      <div class="mb-2">
        {% for t in task.tag_list() %}
          <span class="badge rounded-pill text-bg-secondary me-1">#{{ t }}</span>
        {% endfor %}
      </div>
      {% endif %}

      {% set notifs = task.notify_list() %}
      {% if notifs %}
        <div class="mb-2 small text-muted">🔔 Alerts: {% for n in notifs %}{{ (n ~ 'm') if n < 60 else ((n//60) ~ 'h') }}{% if not loop.last %}, {% endif %}{% endfor %}</div>
      {% endif %}

      <div class="mt-auto d-flex gap-2">
        <a class="btn btn-sm btn-outline-secondary" href="/tasks/{{task.id}}/toggle">{{ 'Reopen' if task.status=='done' else 'Complete' }}</a>
      </div>
    </div>
  </div>
</div>
